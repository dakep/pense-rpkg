language: r
cache: packages
r:
  - release

warnings_are_errors: true
r_packages:
  - pkgdown

env:
  global:
    - MAKE="make -j 2"

branches:
  only:
    - master
    - /^release\/v?[\d\.]+$/

stages:
 - name: check
   if: commit_message != "Re-build README.Rmd"
 - name: extendedcheck
   if: branch = master AND commit_message != "Re-build README.Rmd"
 - name: pkgdown
   if: commit_message != "Re-build README.Rmd"
   #if: branch = master AND commit_message != "Re-build README.Rmd"

jobs:
  - stage: check
  - stage: extendedcheck
    name: R-devel
    r: devel
  - stage: extendedcheck
    name: R-oldrel
    r: oldrel
  - stage: pkgdown
    script: Rscript -e 'pkgdown::build_site()'
    deploy:
      edge: true
      provider: pages
      token:
        secure: FlT61HEHPClWDHNdP0AVhXtaG/yw6ffaBQJxHTZRozss7lD3jho9Uew/lFKyrtYzSFI5h3hez32JO3gahnGvXtAQkVSeZoKYH6JiUm2EMuNUDkB9QmdGAxoF7o9aNSKUNSfYGDqc4+UlW7p+3C8uhdAC8FgH3jqUjCWFYLToN68ifPBNXMKODpJdBMcznXT5otIYI9RpM+Mu+F60pOZXgYQglo/VkCseyAY1sIL8jtbL7YhgzKUOJtlxLDVDslsXNRoUX7uUj02kp4D6kGz59bQMZfC1LM4RR9+JE1K0yTpVBBFgbG/UMVAi2f70vGqlFcMLvQE2ECrb9pHt/H7pM533cCEppq+Iao9DLJRueS1IafUvuuHMtZRixRe276dj1MNWRsRzItTlf1g/Oqh91jSRGOTm7dN6weW1IABmy8QeR76j9GGZX0MTYhIqpIAY+EWlET0/luINeXUNH7ld55dvPlGmdlOwVnzu7080Op0zqWW7F0FXVTOHVixyk6Rg3s5fqXH8AcI+meQ132OSxHqPwiAb54Z74KXfNd5lMp4uPLRLuR/9fgaBnvwp4SshSgILjD7Ryn4nNsVYpl4Me2aEAPGn3J8rPPGdaEPGyd0nJ5eDOLzm9YoFxvD5som+E9OZ7DU1wN/nBHQhHuGa0v3rqGUhjJzoVFJwaUD6gxk=
      keep_history: true
      local_dir: docs
      on:
        branch: true
