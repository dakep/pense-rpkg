<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controlling the grid of penalization levels • pense</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Controlling the grid of penalization levels">
<meta property="og:description" content="pense">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pense</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/computing_adapense.html">Estimating predictive models</a>
    </li>
    <li>
      <a href="../articles/lambda_grids.html">Controlling the grid of penalization levels</a>
    </li>
    <li>
      <a href="../articles/migration_guide.html">Migrating from pense version 1.x to 2.x</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dakep/pense-rpkg/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><link href="lambda_grids_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="lambda_grids_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Controlling the grid of penalization levels</h1>
                        <h4 class="author">David Kepplinger</h4>
            
            <h4 class="date">2020-10-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dakep/pense-rpkg/blob/master/vignettes/lambda_grids.Rmd"><code>vignettes/lambda_grids.Rmd</code></a></small>
      <div class="hidden name"><code>lambda_grids.Rmd</code></div>

    </div>

    
    
<p>The functions to compute (adaptive) PENSE and PENSEM estimates automatically select a grid of penalization levels. In many cases, this grid is well focused on the interesting range of penalization levels, but sometimes it needs to be adjusted. This guide shows how to adjust the grid of penalization levels for the the function <code><a href="../reference/pense_cv.html">adapense_cv()</a></code>, i.e., for computing adaptive PENSE estimates. The steps, however, apply to <em>all</em> functions for computing robust regularized estimates in the pense package (using or not using cross-validation).</p>
<p>For this guide we first need to load the pense package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dakep.github.io/pense-rpkg">pense</a></span>)
<span class="co">#&gt; Loading required package: Matrix</span>
</pre></div>
<p>For demonstration purposes, let’s simulate data with 50 observations and 40 available predictors. The error distribution is a heavy-tailed <em>t</em>-distribution and only the first 3 predictors are truly relevant for predicting the response <em>y</em>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1234</span>)
<span class="kw">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Weibull.html">rweibull</a></span>(<span class="fl">50</span> <span class="op">*</span> <span class="fl">40</span>, <span class="fl">2</span>, <span class="fl">3</span>), ncol = <span class="fl">40</span>)
<span class="kw">y</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">*</span> <span class="kw">x</span>[, <span class="fl">1</span>] <span class="op">-</span> <span class="fl">1.1</span> <span class="op">*</span> <span class="kw">x</span>[, <span class="fl">2</span>] <span class="op">+</span> <span class="fl">1.2</span> <span class="op">*</span> <span class="kw">x</span>[, <span class="fl">3</span>] <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html">rt</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">x</span>), df = <span class="fl">2</span>)
</pre></div>
<p>To make the demonstration more realistic, let’s add some contamination to the response value of the first 3 observations and to some predictors:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">y</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>] <span class="op">&lt;-</span> <span class="fl">5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="kw">x</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, ], <span class="fl">1</span>, <span class="kw">max</span>)
<span class="kw">x</span>[<span class="fl">3</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">6</span>] <span class="op">&lt;-</span> <span class="fl">1.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="kw">x</span>) <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Cauchy.html">rcauchy</a></span>(<span class="fl">4</span> <span class="op">*</span> <span class="fl">3</span>))
</pre></div>
<div id="adjusting-the-grid-of-penalization-levels" class="section level2">
<h2 class="hasAnchor">
<a href="#adjusting-the-grid-of-penalization-levels" class="anchor"></a>Adjusting the grid of penalization levels</h2>
<p>By default, <code><a href="../reference/pense_cv.html">adapense_cv()</a></code> creates a grid of 50 penalization levels. The grid spans from the “largest” penalization level (i.e., the penalization level where the solution is the intercept-only model) to a multiple of 10<sup>-3</sup> of this largest penalization level.</p>
<p>The number of grid points is controlled with argument <code>nlambda=</code>. The more grid points, the more models are explored, but computation time increases accordingly. For most applications “meaningful” change is only observed between models differing in at least one predictor.</p>
<p>Particularly in the lower end of the grid, the estimated models often don’t differ in the number of predictors and exhibit only marginal differences in the coefficient estimates. This may waste computational resources on exploring an area of little interest. You can adjust the lower endpoint of the automatic grid by changing the multiplier with argument <code>lambda_min_ratio=</code>. The ratio must be less than 1, and the larger (i.e., closer to 1), the narrower the grid. If you need to re-focus the grid on larger values of the penalization level, you can increase the ratio to 10<sup>-1</sup>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1234</span>)
<span class="kw">fit_grid_narrow</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pense_cv.html">adapense_cv</a></span>(<span class="kw">x</span>, <span class="kw">y</span>, alpha = <span class="fl">0.75</span>, lambda_min_ratio = <span class="fl">1e-1</span>, cv_k = <span class="fl">5</span>, cv_repl = <span class="fl">10</span>)
</pre></div>
<p>If the model at the lowest penalization level is still fairly sparse and the best model seems to be in this range, you may need to decrease the ratio, e.g., to 10<sup>-4</sup> or even to 10<sup>-6</sup>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1234</span>)
<span class="kw">fit_grid_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pense_cv.html">adapense_cv</a></span>(<span class="kw">x</span>, <span class="kw">y</span>, alpha = <span class="fl">0.75</span>, lambda_min_ratio = <span class="fl">1e-6</span>, cv_k = <span class="fl">5</span>, cv_repl = <span class="fl">10</span>)
</pre></div>
<div class="figure">
<img src="lambda_grids_files/figure-html/unnamed-chunk-6-1.png" alt="Prediction performance of models estimated on different grids of the penalization level: (a) narrow grid with `lambda_min_ratio=1e-1`, (b) wide grid with `lambda_min_ratio=1e-6`." width="624"><p class="caption">
Prediction performance of models estimated on different grids of the penalization level: (a) narrow grid with <code>lambda_min_ratio=1e-1</code>, (b) wide grid with <code>lambda_min_ratio=1e-6</code>.
</p>
</div>
<p>From these plots we can see that the grid in the left plot is too narrow, as a smaller penalization level than 0.02 would likely lead to a better predictive model. On the right, however, the grid is too wide. Penalization levels less than 10<sup>-3</sup> lead to very similar estimates with similar prediction accuracy, while the range with meaningful change seems to be covered too coarsely.</p>
<p>From this, we can compute adaptive PENSE estimates on a better focused grid with:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1234</span>)
<span class="kw">fit_grid_focused</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pense_cv.html">adapense_cv</a></span>(<span class="kw">x</span>, <span class="kw">y</span>, alpha = <span class="fl">0.75</span>, lambda_min_ratio = <span class="fl">1e-2</span>, cv_k = <span class="fl">5</span>, cv_repl = <span class="fl">10</span>)
</pre></div>
<p>Indeed, the plot shows that the range of interest (around the minimum) is covered by several penalization levels:</p>
<div class="figure">
<img src="lambda_grids_files/figure-html/unnamed-chunk-8-1.png" alt="Prediction performance of models estimated over a well-focused grid of penalization levels." width="480"><p class="caption">
Prediction performance of models estimated over a well-focused grid of penalization levels.
</p>
</div>
<div id="manually-supplying-a-grid-of-penalization-levels" class="section level3">
<h3 class="hasAnchor">
<a href="#manually-supplying-a-grid-of-penalization-levels" class="anchor"></a>Manually supplying a grid of penalization levels</h3>
<p>The function <code><a href="../reference/pense_cv.html">adapense_cv()</a></code> and friends also allows you to specify your own grid of penalization levels via the <code>lambda=</code> argument.</p>
<p>Note that for <code><a href="../reference/pense_cv.html">adapense_cv()</a></code> the argument <code>lambda=</code> applies to both the preliminary PENSE estimate and the adaptive PENSE estimate. In most cases, however, this is not what you want. A sensible grid of penalization levels for the preliminary estimate is in general quite different from a good grid of penalization levels for the adaptive estimate.</p>
<p>To compute adaptive PENSE estimates with separately specified manual grids for the preliminary and the adaptive PENSE estimates, you need to compute them manually via</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">fit_preliminary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pense_cv.html">pense_cv</a></span>(<span class="kw">x</span>, <span class="kw">y</span>, alpha = <span class="fl">0</span>, cv_k = <span class="fl">5</span>, cv_repl = <span class="fl">10</span>, lambda = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1e-5</span>, <span class="fl">1e-4</span>, <span class="fl">1e-3</span>, <span class="fl">1e-2</span>, <span class="fl">1e-1</span>, <span class="fl">1</span>))
<span class="kw">exponent</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="kw">penalty_loadings</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="kw">fit_preliminary</span>)[<span class="op">-</span><span class="fl">1</span>])<span class="op">^</span><span class="kw">exponent</span>
<span class="kw">fit_adaptive</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pense_cv.html">pense_cv</a></span>(<span class="kw">x</span>, <span class="kw">y</span>, alpha = <span class="fl">0.75</span>, cv_k = <span class="fl">5</span>, cv_repl = <span class="fl">10</span>, lambda = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">5e-5</span>, <span class="fl">5e-4</span>, <span class="fl">5e-3</span>, <span class="fl">5e-2</span>, <span class="fl">5e-1</span>, <span class="fl">5</span>))
</pre></div>
<p>The function <code><a href="../reference/pensem_cv.html">pensem_cv()</a></code> allows finer control over the grids. It supports the argument <code>lambda=</code>, which would use the same grid of penalization levels for the S- and M-estimates. But <code><a href="../reference/pensem_cv.html">pensem_cv()</a></code> additionally supports arguments <code>lambda_s=</code> and <code>lambda_m=</code> to manually specify separate grids for the S- and the M-estimates.</p>
</div>
</div>
<div id="section" class="section level2">
<h2></h2>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by David Kepplinger, Matías Salibián-Barrera, Gabriela Cohen Freue.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
