<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Controlling the grid of penalization levels • pense</title>
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Controlling the grid of penalization levels">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pense</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.5.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/computing_adapense.html">Estimating predictive models</a></li>
    <li><a class="dropdown-item" href="../articles/lambda_grids.html">Controlling the grid of penalization levels</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dakep/pense-rpkg/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Controlling the grid of penalization levels</h1>
                        <h4 data-toc-skip class="author">David
Kepplinger</h4>
            
            <h4 data-toc-skip class="date">2026-01-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dakep/pense-rpkg/blob/main/vignettes/lambda_grids.Rmd" class="external-link"><code>vignettes/lambda_grids.Rmd</code></a></small>
      <div class="d-none name"><code>lambda_grids.Rmd</code></div>
    </div>

    
    
<p>The functions to compute (adaptive) PENSE and PENSEM estimates
automatically select a grid of penalization levels. In many cases, this
grid is well focused on the interesting range of penalization levels,
but sometimes it needs to be adjusted. This guide shows how to adjust
the grid of penalization levels for the the function
<code><a href="../reference/pense_cv.html">adapense_cv()</a></code>, i.e., for computing adaptive PENSE
estimates. The steps, however, apply to <em>all</em> functions for
computing robust regularized estimates in the pense package (using or
not using cross-validation).</p>
<p>For this guide we first need to load the pense package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dakep.github.io/pense-rpkg/" class="external-link">pense</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: Matrix</span></span></code></pre></div>
<p>For demonstration purposes, let’s simulate data with 50 observations
and 40 available predictors. The error distribution is a heavy-tailed
<em>t</em>-distribution and only the first 3 predictors are truly
relevant for predicting the response <em>y</em>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Weibull.html" class="external-link">rweibull</a></span><span class="op">(</span><span class="fl">50</span> <span class="op">*</span> <span class="fl">40</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1.1</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1.2</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">rt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, df <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>To make the demonstration more realistic, let’s add some
contamination to the response value of the first 3 observations and to
some predictors:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span>, <span class="fl">1</span>, <span class="va">max</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Cauchy.html" class="external-link">rcauchy</a></span><span class="op">(</span><span class="fl">4</span> <span class="op">*</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="adjusting-the-grid-of-penalization-levels">Adjusting the grid of penalization levels<a class="anchor" aria-label="anchor" href="#adjusting-the-grid-of-penalization-levels"></a>
</h2>
<p>By default, <code><a href="../reference/pense_cv.html">adapense_cv()</a></code> creates a grid of 50
penalization levels. The grid spans from the “largest” penalization
level (i.e., the penalization level where the solution is the
intercept-only model) to a multiple of 10<sup>-3</sup> of this largest
penalization level.</p>
<p>The number of grid points is controlled with argument
<code>nlambda=</code>. The more grid points, the more models are
explored, but computation time increases accordingly. For most
applications “meaningful” change is only observed between models
differing in at least one predictor.</p>
<p>Particularly in the lower end of the grid, the estimated models often
don’t differ in the number of predictors and exhibit only marginal
differences in the coefficient estimates. This may waste computational
resources on exploring an area of little interest. You can adjust the
lower endpoint of the automatic grid by changing the multiplier with
argument <code>lambda_min_ratio=</code>. The ratio must be less than 1,
and the closer to 1 the narrower the grid. If you need to re-focus the
grid on larger values of the penalization level, you can increase the
ratio, for example, to 0.5:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">fit_grid_narrow</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pense_cv.html">adapense_cv</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, alpha <span class="op">=</span> <span class="fl">0.75</span>, lambda_min_ratio <span class="op">=</span> <span class="fl">5e-1</span>, cv_k <span class="op">=</span> <span class="fl">5</span>, cv_repl <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>If the model at the lowest penalization level is still fairly sparse
and the best model seems to be in this range, you may need to decrease
the ratio, e.g., to 0.05:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">fit_grid_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pense_cv.html">adapense_cv</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, alpha <span class="op">=</span> <span class="fl">0.75</span>, lambda_min_ratio <span class="op">=</span> <span class="fl">5e-2</span>, cv_k <span class="op">=</span> <span class="fl">5</span>, cv_repl <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="lambda_grids_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" alt="Prediction performance of models estimated on different grids of the penalization level: (a) narrow grid with `lambda_min_ratio=1e-1`, (b) wide grid with `lambda_min_ratio=1e-6`." width="624"><p class="caption">
Prediction performance of models estimated on different grids of the
penalization level: (a) narrow grid with
<code>lambda_min_ratio=1e-1</code>, (b) wide grid with
<code>lambda_min_ratio=1e-6</code>.
</p>
</div>
<p>From these plots we can see that the grid in the left plot is too
narrow, as a smaller penalization level than 0.02 would likely lead to a
better predictive model. On the right, however, the grid is too wide.
Penalization levels less than 0.01 seam to have substantially worse
prediction accuracy. Therefore, we can compute adaptive PENSE estimates
on a better focused grid with:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">fit_grid_focused</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pense_cv.html">adapense_cv</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, alpha <span class="op">=</span> <span class="fl">0.75</span>, lambda_min_ratio <span class="op">=</span> <span class="fl">1e-1</span>, cv_k <span class="op">=</span> <span class="fl">5</span>, cv_repl <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>Indeed, the plot shows that the range of interest (around the
minimum) is covered by several penalization levels:</p>
<div class="figure">
<img src="lambda_grids_files/figure-html/unnamed-chunk-8-1.png" class="r-plt" alt="Prediction performance of models estimated over a well-focused grid of penalization levels." width="480"><p class="caption">
Prediction performance of models estimated over a well-focused grid of
penalization levels.
</p>
</div>
<div class="section level3">
<h3 id="manually-supplying-a-grid-of-penalization-levels">Manually supplying a grid of penalization levels<a class="anchor" aria-label="anchor" href="#manually-supplying-a-grid-of-penalization-levels"></a>
</h3>
<p>The function <code><a href="../reference/pense_cv.html">adapense_cv()</a></code> and friends also allows you
to specify your own grid of penalization levels via the
<code>lambda=</code> argument.</p>
<p>Note that for <code><a href="../reference/pense_cv.html">adapense_cv()</a></code> the argument
<code>lambda=</code> applies to both the preliminary PENSE estimate and
the adaptive PENSE estimate. In most cases, however, this is not what
you want. A sensible grid of penalization levels for the preliminary
estimate is in general quite different from a good grid of penalization
levels for the adaptive estimate.</p>
<p>To compute adaptive PENSE estimates with separately specified manual
grids for the preliminary and the adaptive PENSE estimates, you need to
compute them manually via</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_preliminary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pense_cv.html">pense_cv</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, alpha <span class="op">=</span> <span class="fl">0</span>, cv_k <span class="op">=</span> <span class="fl">5</span>, cv_repl <span class="op">=</span> <span class="fl">10</span>, </span>
<span>                            lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">exponent</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">penalty_loadings</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_preliminary</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="va">exponent</span></span>
<span><span class="va">fit_adaptive</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pense_cv.html">pense_cv</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, alpha <span class="op">=</span> <span class="fl">0.75</span>, cv_k <span class="op">=</span> <span class="fl">5</span>, cv_repl <span class="op">=</span> <span class="fl">10</span>, </span>
<span>                         lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_adaptive</span><span class="op">)</span></span>
<span><span class="co">#&gt; PENSE fit with prediction performance estimated by 10 replications of 5-fold </span></span>
<span><span class="co">#&gt; ris cross-validation.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 8 out of 40 predictors have non-zero coefficients:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                Estimate</span></span>
<span><span class="co">#&gt; (Intercept)  1.56453280</span></span>
<span><span class="co">#&gt; X1           0.41947742</span></span>
<span><span class="co">#&gt; X2          -0.49314705</span></span>
<span><span class="co">#&gt; X3           0.41263669</span></span>
<span><span class="co">#&gt; X5           0.05041418</span></span>
<span><span class="co">#&gt; X26         -0.08230093</span></span>
<span><span class="co">#&gt; X29          0.03015557</span></span>
<span><span class="co">#&gt; X36         -0.07564768</span></span>
<span><span class="co">#&gt; X39         -0.03997095</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Hyper-parameters: lambda=0.9457416, alpha=0.75</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Kepplinger, Matías Salibián-Barrera, Gabriela Cohen Freue.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
