#!/bin/bash

sh cleanup

ROOT_DIR="pense-rpkg"

VERSION=`sed -En 's/Version: ([0-9\.]+)/\1/p' DESCRIPTION`
PACKAGE_NAME=`sed -En 's/Package: ([a-zA-Z0-9_]+)/\1/p' DESCRIPTION`

DIRNAME="${PACKAGE_NAME}_${VERSION}"

pushd ..

ln -sv "${ROOT_DIR}" "${PACKAGE_NAME}"

tar hczf "${ROOT_DIR}/builds/$DIRNAME.tar.gz" --exclude=".*" --exclude="*Makevars.dbg" \
    --exclude="*.Rproj" --exclude="*.o" --exclude="*.ac" --exclude="*.so"  --exclude="bundle" \
    --exclude="build" --exclude="builds/" --exclude="examples/" "${PACKAGE_NAME}"

rm "${PACKAGE_NAME}"

popd
