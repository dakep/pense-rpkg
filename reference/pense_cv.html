<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Cross-validation for (Adaptive) PENSE Estimates — pense_cv • pense</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Cross-validation for (Adaptive) PENSE Estimates — pense_cv" />
<meta property="og:description" content="Perform (repeated) K-fold cross-validation for pense().
adapense_cv() is a convenience wrapper to compute adaptive PENSE estimates." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pense</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/dakep/pense-rpkg/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Cross-validation for (Adaptive) PENSE Estimates</h1>
    <small class="dont-index">Source: <a href='https://github.com/dakep/pense-rpkg/blob/master/R/pense_regression.R'><code>R/pense_regression.R</code></a></small>
    <div class="hidden name"><code>pense_cv.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Perform (repeated) K-fold cross-validation for <code><a href='pense.html'>pense()</a></code>.</p>
<p><code>adapense_cv()</code> is a convenience wrapper to compute adaptive PENSE estimates.</p>
    </div>

    <pre class="usage"><span class='fu'>pense_cv</span>(
  <span class='kw'>x</span>,
  <span class='kw'>y</span>,
  standardize = <span class='fl'>TRUE</span>,
  <span class='kw'>lambda</span>,
  <span class='kw'>cv_k</span>,
  cv_repl = <span class='fl'>1</span>,
  cv_metric = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"tau_size"</span>, <span class='st'>"mape"</span>, <span class='st'>"rmspe"</span>),
  fit_all = <span class='fl'>TRUE</span>,
  cl = <span class='kw'>NULL</span>,
  <span class='kw'>...</span>
)

<span class='fu'>adapense_cv</span>(<span class='kw'>x</span>, <span class='kw'>y</span>, <span class='kw'>alpha</span>, alpha_preliminary = <span class='fl'>0</span>, exponent = <span class='fl'>1</span>, <span class='kw'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p><code>n</code> by <code>p</code> matrix of numeric predictors.</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>vector of response values of length <code>n</code>.</p></td>
    </tr>
    <tr>
      <th>standardize</th>
      <td><p>whether to standardize the <code>x</code> variables prior to fitting the PENSE estimates.
Can also be set to <code>"cv_only"</code>, in which case the input data is not standardized, but the
training data in the CV folds is scaled to match the scaling of the input data.
Coefficients are always returned on the original scale. This can fail for variables with a large
proportion of a single value (e.g., zero-inflated data). In this case, either compute with
<code>standardize = FALSE</code> or standardize the data manually.</p></td>
    </tr>
    <tr>
      <th>lambda</th>
      <td><p>optional user-supplied sequence of penalization levels. If given and not <code>NULL</code>, <code>nlambda</code> and
<code>lambda_min_ratio</code> are ignored.</p></td>
    </tr>
    <tr>
      <th>cv_k</th>
      <td><p>number of folds per cross-validation.</p></td>
    </tr>
    <tr>
      <th>cv_repl</th>
      <td><p>number of cross-validation replications.</p></td>
    </tr>
    <tr>
      <th>cv_metric</th>
      <td><p>either a string specifying the performance metric to use, or a function to evaluate prediction
errors in a single CV replication. If a function, it is called with a single numeric vector of
prediction errors and must return a scalar number.</p></td>
    </tr>
    <tr>
      <th>fit_all</th>
      <td><p>If <code>TRUE</code>, fit the model for all penalization levels. Otherwise, only at penalization
level with smallest average CV performance.</p></td>
    </tr>
    <tr>
      <th>cl</th>
      <td><p>a <a href='https://rdrr.io/r/parallel/makeCluster.html'>parallel</a> cluster. Can only be used if <code>ncores = 1</code>, because multi-threading
can not be used in parallel R sessions on the same host.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Arguments passed on to <code><a href='pense.html'>pense</a></code></p><dl>
    <dt><code>nlambda</code></dt><dd><p>number of penalization levels.</p></dd>
    <dt><code>lambda_min_ratio</code></dt><dd><p>Smallest value of the penalization level as a fraction of the largest level (i.e., the
smallest value for which all coefficients are zero). The default depends on the sample
size relative to the number of variables and <code>alpha</code>. If more observations than variables
are available, the default is <code>1e-3 * alpha</code>, otherwise <code>1e-2 * alpha</code>.</p></dd>
    <dt><code>nlambda_enpy</code></dt><dd><p>number of penalization levels where the EN-PY initial estimate is computed.</p></dd>
    <dt><code>penalty_loadings</code></dt><dd><p>a vector of positive penalty loadings (a.k.a. weights) for different penalization of each
coefficient. Only allowed for <code>alpha</code> &gt; 0.</p></dd>
    <dt><code>enpy_lambda</code></dt><dd><p>optional user-supplied sequence of penalization levels at which EN-PY initial estimates are
computed. If given and not <code>NULL</code>, <code>nlambda_enpy</code> is ignored.</p></dd>
    <dt><code>other_starts</code></dt><dd><p>a list of other staring points, created by <code><a href='starting_point.html'>starting_point()</a></code>.
If the output of <code><a href='enpy_initial_estimates.html'>enpy_initial_estimates()</a></code> is given, the starting points will be <em>shared</em>
among all penalization levels.
Note that if a the starting point is <em>specific</em> to a penalization level, this penalization
level is added to the grid of penalization levels (either the manually specified grid in <code>lambda</code>
or the automatically generated grid of size <code>nlambda</code>).
If <code>standardize = TRUE</code>, the starting points are also scaled.</p></dd>
    <dt><code>intercept</code></dt><dd><p>include an intercept in the model.</p></dd>
    <dt><code>bdp</code></dt><dd><p>desired breakdown point of the estimator, between 0 and 0.5.</p></dd>
    <dt><code>eps</code></dt><dd><p>numerical tolerance.</p></dd>
    <dt><code>explore_solutions</code></dt><dd><p>number of solutions to compute up to the desired precision <code>eps</code>.</p></dd>
    <dt><code>explore_tol</code></dt><dd><p>numerical tolerance for exploring possible solutions. Should be (much) looser than <code>eps</code> to
be useful.</p></dd>
    <dt><code>max_solutions</code></dt><dd><p>only retain up to <code>max_solutions</code> unique solutions per penalization level.</p></dd>
    <dt><code>comparison_tol</code></dt><dd><p>numeric tolerance to determine if two solutions are equal. The comparison is first done
on the absolute difference in the value of the objective function at the solution
If this is less than <code>comparison_tol</code>, two solutions are deemed equal if the squared difference
of the intercepts is less than <code>comparison_tol</code> and the squared \(L_2\) norm of the
difference vector is less than <code>comparison_tol</code>.</p></dd>
    <dt><code>add_zero_based</code></dt><dd><p>also consider the 0-based regularization path. See details for a description.</p></dd>
    <dt><code>enpy_specific</code></dt><dd><p>use the EN-PY initial estimates only at the penalization level they are computed for.
See details for a description.</p></dd>
    <dt><code>sparse</code></dt><dd><p>use sparse coefficient vectors.</p></dd>
    <dt><code>ncores</code></dt><dd><p>number of CPU cores to use in parallel. By default, only one CPU core is used. May not be supported
on your platform, in which case a warning is given.</p></dd>
    <dt><code>algorithm_opts</code></dt><dd><p>options for the MM algorithm to compute the estimates. See <code><a href='mm_algorithm_options.html'>mm_algorithm_options()</a></code> for
details.</p></dd>
    <dt><code>mscale_opts</code></dt><dd><p>options for the M-scale estimation. See <code><a href='mscale_algorithm_options.html'>mscale_algorithm_options()</a></code> for details.</p></dd>
    <dt><code>enpy_opts</code></dt><dd><p>options for the ENPY initial estimates, created with the
<code><a href='enpy_options.html'>enpy_options()</a></code> function. See <code><a href='enpy_initial_estimates.html'>enpy_initial_estimates()</a></code> for details.</p></dd>
    <dt><code>cv_objective</code></dt><dd><p>deprecated and ignored. See <code>pense_cv()</code> for estimating prediction performance
via cross-validation.</p></dd>
  
</dl></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>elastic net penalty mixing parameter with \(0 \le \alpha \le 1\). <code>alpha = 1</code> is the LASSO penalty,
and <code>alpha = 0</code> the Ridge penalty.</p></td>
    </tr>
    <tr>
      <th>alpha_preliminary</th>
      <td><p><code>alpha</code> parameter for the preliminary estimate.</p></td>
    </tr>
    <tr>
      <th>exponent</th>
      <td><p>the exponent for computing the penalty loadings based on the preliminary estimate.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a list with components:</p><dl>
<dt><code>lambda</code></dt><dd><p>the sequence of penalization levels.</p></dd>
<dt><code>cvres</code></dt><dd><p>data frame of average cross-validated performance.</p></dd>
<dt><code>cv_replications</code></dt><dd><p>matrix of cross-validated performance metrics, one column per replication.
Rows are in the same order as in <code>cvres</code>.</p></dd>
<dt><code>call</code></dt><dd><p>the original call.</p></dd>
<dt><code>estimates</code></dt><dd><p>the estimates fitted on the full data. Same format as returned by <code><a href='pense.html'>pense()</a></code>.</p></dd>

</dl>

<p>the object returned by <code>adapense_cv()</code> has additional components</p><dl>
<dt><code>preliminary</code></dt><dd><p>the CV results for the preliminary estimate.</p></dd>
<dt><code>penalty_loadings</code></dt><dd><p>the penalty loadings used for the adaptive PENSE estimate.</p></dd>

</dl>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The built-in CV metrics are</p><dl>
<dt><code>"tau_size"</code></dt><dd><p>\(\tau\)-size of the prediction error, computed by <code><a href='tau_size.html'>tau_size()</a></code> (default).</p></dd>
<dt><code>"mape"</code></dt><dd><p>Median absolute prediction error.</p></dd>
<dt><code>"rmspe"</code></dt><dd><p>Root mean squared prediction error.</p></dd>

</dl>

<p><code>adapense_cv()</code> is a convenience wrapper which performs 3 steps:</p><ol>
<li><p>compute preliminary estimates via <code>pense_cv(..., alpha = alpha_preliminary)</code>,</p></li>
<li><p>computes the penalty loadings from the estimate <code>beta</code> with best prediction performance by
<code>adapense_loadings = 1 / abs(beta)^exponent</code>, and</p></li>
<li><p>compute the adaptive PENSE estimates via <code>pense_cv(..., penalty_loadings = adapense_loadings)</code>.</p></li>
</ol>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='pense.html'>pense()</a></code> for computing regularized S-estimates without cross-validation.</p>
<p><code><a href='coef.pense_cvfit.html'>coef.pense_cvfit()</a></code> for extracting coefficient estimates.</p>
<p><code><a href='plot.pense_cvfit.html'>plot.pense_cvfit()</a></code> for plotting the CV performance or the regularization path.</p>
<p>Other functions to compute robust estimates with CV: 
<code><a href='pensem_cv.html'>pensem_cv</a>()</code>,
<code><a href='regmest_cv.html'>regmest_cv</a>()</code></p>
<p>Other functions to compute robust estimates with CV: 
<code><a href='pensem_cv.html'>pensem_cv</a>()</code>,
<code><a href='regmest_cv.html'>regmest_cv</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Compute the adaptive PENSE regularization path for Freeny's</span>
<span class='co'># revenue data (see ?freeny)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='kw'>freeny</span>)
<span class='kw'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span>(<span class='kw'>freeny</span>[ , <span class='fl'>2</span><span class='op'>:</span><span class='fl'>5</span>])

<span class='co'>## Either use the convenience function directly ...</span>
<span class='kw'>ada_convenience</span> <span class='op'>&lt;-</span> <span class='fu'>adapense_cv</span>(<span class='kw'>x</span>, <span class='kw'>freeny</span><span class='op'>$</span><span class='kw'>y</span>, alpha = <span class='fl'>0.5</span>,
                               cv_repl = <span class='fl'>2</span>, cv_k = <span class='fl'>4</span>)

<span class='co'>## ... or compute the steps manually:</span>
<span class='co'># Step 1: Compute preliminary estimates with CV</span>
<span class='kw'>preliminary_estimate</span> <span class='op'>&lt;-</span> <span class='fu'>pense_cv</span>(<span class='kw'>x</span>, <span class='kw'>freeny</span><span class='op'>$</span><span class='kw'>y</span>, alpha = <span class='fl'>0</span>,
                                 cv_repl = <span class='fl'>2</span>, cv_k = <span class='fl'>4</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span>(<span class='kw'>preliminary_estimate</span>, se_mult = <span class='fl'>1</span>)
</div><div class='img'><img src='pense_cv-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Step 2: Use the coefficients with best prediction performance</span>
<span class='co'># to define the penality loadings:</span>
<span class='kw'>prelim_coefs</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span>(<span class='kw'>preliminary_estimate</span>, lambda = <span class='st'>'min'</span>)
<span class='kw'>pen_loadings</span> <span class='op'>&lt;-</span> <span class='fl'>1</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span>(<span class='kw'>prelim_coefs</span>[<span class='op'>-</span><span class='fl'>1</span>])

<span class='co'># Step 3: Compute the adaptive PENSE estimates and estimate</span>
<span class='co'># their prediction performance.</span>
<span class='kw'>ada_manual</span> <span class='op'>&lt;-</span> <span class='fu'>pense_cv</span>(<span class='kw'>x</span>, <span class='kw'>freeny</span><span class='op'>$</span><span class='kw'>y</span>, alpha = <span class='fl'>0.5</span>, cv_repl = <span class='fl'>2</span>,
                       cv_k = <span class='fl'>4</span>, penalty_loadings = <span class='kw'>pen_loadings</span>)

<span class='co'># Visualize the prediction performance and coefficient path of</span>
<span class='co'># the adaptive PENSE estimates (manual vs. automatic)</span>
<span class='kw'>def.par</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span>(no.readonly = <span class='fl'>TRUE</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/layout.html'>layout</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span>, ncol = <span class='fl'>2</span>, byrow = <span class='fl'>TRUE</span>))
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span>(<span class='kw'>ada_convenience</span><span class='op'>$</span><span class='kw'>preliminary</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span>(<span class='kw'>preliminary_estimate</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span>(<span class='kw'>ada_convenience</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span>(<span class='kw'>ada_manual</span>)
</div><div class='img'><img src='pense_cv-2.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span>(<span class='kw'>def.par</span>)
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David Kepplinger, Matías Salibián-Barrera, Gabriela Cohen Freue.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


